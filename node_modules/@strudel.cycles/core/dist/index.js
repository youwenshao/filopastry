"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const Fraction=require("fraction.js");Fraction.prototype.sam=function(){return this.floor()};Fraction.prototype.nextSam=function(){return this.sam().add(1)};Fraction.prototype.wholeCycle=function(){return new TimeSpan(this.sam(),this.nextSam())};Fraction.prototype.cyclePos=function(){return this.sub(this.sam())};Fraction.prototype.lt=function(t){return this.compare(t)<0};Fraction.prototype.gt=function(t){return this.compare(t)>0};Fraction.prototype.lte=function(t){return this.compare(t)<=0};Fraction.prototype.gte=function(t){return this.compare(t)>=0};Fraction.prototype.eq=function(t){return this.compare(t)==0};Fraction.prototype.max=function(t){return this.gt(t)?this:t};Fraction.prototype.min=function(t){return this.lt(t)?this:t};Fraction.prototype.show=function(){return this.s*this.n+"/"+this.d};Fraction.prototype.or=function(t){return this.eq(0)?t:this};const fraction=t=>Fraction(t),gcd=(...t)=>t.reduce((e,n)=>e.gcd(n),fraction(1));fraction._original=Fraction;class TimeSpan{constructor(e,n){this.begin=fraction(e),this.end=fraction(n)}get spanCycles(){const e=[];var n=this.begin;const o=this.end,s=o.sam();if(n.equals(o))return[new TimeSpan(n,o)];for(;o.gt(n);){if(n.sam().equals(s)){e.push(new TimeSpan(n,this.end));break}const i=n.nextSam();e.push(new TimeSpan(n,i)),n=i}return e}get duration(){return this.end.sub(this.begin)}cycleArc(){const e=this.begin.cyclePos(),n=e.add(this.duration);return new TimeSpan(e,n)}withTime(e){return new TimeSpan(e(this.begin),e(this.end))}withEnd(e){return new TimeSpan(this.begin,e(this.end))}withCycle(e){const n=this.begin.sam(),o=n.add(e(this.begin.sub(n))),s=n.add(e(this.end.sub(n)));return new TimeSpan(o,s)}intersection(e){const n=this.begin.max(e.begin),o=this.end.min(e.end);if(!n.gt(o)&&!(n.equals(o)&&(n.equals(this.end)&&this.begin.lt(this.end)||n.equals(e.end)&&e.begin.lt(e.end))))return new TimeSpan(n,o)}intersection_e(e){const n=this.intersection(e);if(n==null)throw"TimeSpans do not intersect";return n}midpoint(){return this.begin.add(this.duration.div(fraction(2)))}equals(e){return this.begin.equals(e.begin)&&this.end.equals(e.end)}show(){return this.begin.show()+" → "+this.end.show()}}class Hap{constructor(e,n,o,s={},i=!1){this.whole=e,this.part=n,this.value=o,this.context=s,this.stateful=i,i&&console.assert(typeof this.value=="function","Stateful values must be functions")}get duration(){return this.whole.end.sub(this.whole.begin).mul(typeof this.value?.clip=="number"?this.value?.clip:1)}get endClipped(){return this.whole.begin.add(this.duration)}wholeOrPart(){return this.whole?this.whole:this.part}withSpan(e){const n=this.whole?e(this.whole):void 0;return new Hap(n,e(this.part),this.value,this.context)}withValue(e){return new Hap(this.whole,this.part,e(this.value),this.context)}hasOnset(){return this.whole!=null&&this.whole.begin.equals(this.part.begin)}resolveState(e){if(this.stateful&&this.hasOnset()){console.log("stateful");const n=this.value,[o,s]=n(e);return[o,new Hap(this.whole,this.part,s,this.context,!1)]}return[e,this]}spanEquals(e){return this.whole==null&&e.whole==null||this.whole.equals(e.whole)}equals(e){return this.spanEquals(e)&&this.part.equals(e.part)&&this.value===e.value}show(e=!1){const n=typeof this.value=="object"?e?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value;var o="";if(this.whole==null)o="~"+this.part.show;else{var s=this.whole.begin.equals(this.part.begin)&&this.whole.end.equals(this.part.end);this.whole.begin.equals(this.part.begin)||(o=this.whole.begin.show()+" ⇜ "),s||(o+="("),o+=this.part.show(),s||(o+=")"),this.whole.end.equals(this.part.end)||(o+=" ⇝ "+this.whole.end.show())}return"[ "+o+" | "+n+" ]"}showWhole(e=!1){return`${this.whole==null?"~":this.whole.show()}: ${typeof this.value=="object"?e?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value}`}combineContext(e){const n=this;return{...n.context,...e.context,locations:(n.context.locations||[]).concat(e.context.locations||[])}}setContext(e){return new Hap(this.whole,this.part,this.value,e)}ensureObjectValue(){if(typeof this.value!="object")throw new Error(`expected hap.value to be an object, but got "${this.value}". Hint: append .note() or .s() to the end`,"error")}}class State{constructor(e,n={}){this.span=e,this.controls=n}setSpan(e){return new State(e,this.controls)}withSpan(e){return this.setSpan(e(this.span))}setControls(e){return new State(this.span,e)}}const isNoteWithOctave=t=>/^[a-gA-G][#bs]*[0-9]$/.test(t),isNote=t=>/^[a-gA-G][#bsf]*[0-9]?$/.test(t),tokenizeNote=t=>{if(typeof t!="string")return[];const[e,n="",o]=t.match(/^([a-gA-G])([#bsf]*)([0-9])?$/)?.slice(1)||[];return e?[e,n,o?Number(o):void 0]:[]},noteToMidi=t=>{const[e,n,o=3]=tokenizeNote(t);if(!e)throw new Error('not a note: "'+t+'"');const s={c:0,d:2,e:4,f:5,g:7,a:9,b:11}[e.toLowerCase()],i=n?.split("").reduce((a,l)=>a+{"#":1,b:-1,s:1,f:-1}[l],0)||0;return(Number(o)+1)*12+s+i},midiToFreq=t=>Math.pow(2,(t-69)/12)*440,freqToMidi=t=>12*Math.log(t/440)/Math.LN2+69,valueToMidi=(t,e)=>{if(typeof t!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:o}=t;if(typeof n=="number")return freqToMidi(n);if(typeof o=="string")return noteToMidi(o);if(typeof o=="number")return o;if(!e)throw new Error("valueToMidi: expected freq or note to be set");return e},getFreq=t=>midiToFreq(typeof t=="number"?t:noteToMidi(t)),pcs=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],midi2note=t=>{const e=Math.floor(t/12)-1;return pcs[t%12]+e},_mod=(t,e)=>(t%e+e)%e,getPlayableNoteValue=t=>{let{value:e,context:n}=t,o=e;if(typeof o=="object"&&!Array.isArray(o)&&(o=o.note||o.n||o.value,o===void 0))throw new Error(`cannot find a playable note for ${JSON.stringify(e)}`);if(typeof o=="number"&&n.type!=="frequency")o=midiToFreq(t.value);else if(typeof o=="number"&&n.type==="frequency")o=t.value;else if(typeof o!="string"||!isNote(o))throw new Error("not a note: "+JSON.stringify(o));return o},getFrequency=t=>{let{value:e,context:n}=t;if(typeof e=="object")return e.freq?e.freq:getFreq(e.note||e.n||e.value);if(typeof e=="number"&&n.type!=="frequency")e=midiToFreq(t.value);else if(typeof e=="string"&&isNote(e))e=midiToFreq(noteToMidi(t.value));else if(typeof e!="number")throw new Error("not a note or frequency: "+e);return e},rotate=(t,e)=>t.slice(e).concat(t.slice(0,e)),pipe=(...t)=>t.reduce((e,n)=>(...o)=>e(n(...o)),e=>e),compose=(...t)=>pipe(...t.reverse()),removeUndefineds=t=>t.filter(e=>e!=null),flatten=t=>[].concat(...t),id=t=>t,constant=(t,e)=>t,listRange=(t,e)=>Array.from({length:e-t+1},(n,o)=>o+t);function curry(t,e,n=t.length){const o=function s(...i){if(i.length>=n)return t.apply(this,i);{const a=function(...l){return s.apply(this,i.concat(l))};return e&&e(a,i),a}};return e&&e(o,[]),o}function parseNumeral(t){const e=Number(t);if(!isNaN(e))return e;if(isNote(t))return noteToMidi(t);throw new Error(`cannot parse as numeral: "${t}"`)}function mapArgs(t,e){return(...n)=>t(...n.map(e))}function numeralArgs(t){return mapArgs(t,parseNumeral)}function parseFractional(t){const e=Number(t);if(!isNaN(e))return e;const n={pi:Math.PI,w:1,h:.5,q:.25,e:.125,s:.0625,t:1/3,f:.2,x:1/6}[t];if(typeof n<"u")return n;throw new Error(`cannot parse as fractional: "${t}"`)}const fractionalArgs=t=>mapArgs(t,parseFractional),splitAt=function(t,e){return[e.slice(0,t),e.slice(t)]},zipWith=(t,e,n)=>e.map((o,s)=>t(o,n[s])),clamp=(t,e,n)=>Math.min(Math.max(t,e),n),solfeggio=["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"],indian=["Sa","Re","Ga","Ma","Pa","Dha","Ni"],german=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Hb","H"],byzantine=["Ni","Pab","Pa","Voub","Vou","Ga","Dib","Di","Keb","Ke","Zob","Zo"],japanese=["I","Ro","Ha","Ni","Ho","He","To"],english=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],sol2note=(t,e="letters")=>{const o=(e==="solfeggio"?solfeggio:e==="indian"?indian:e==="german"?german:e==="byzantine"?byzantine:e==="japanese"?japanese:english)[t%12],s=Math.floor(t/12)-1;return o+s};function unionWithObj(t,e,n){if(typeof e?.value=="number"){const s=Object.keys(t).filter(a=>typeof t[a]=="number"),i=Object.fromEntries(s.map(a=>[a,e.value]));e=Object.assign(e,i),delete e.value}const o=Object.keys(t).filter(s=>Object.keys(e).includes(s));return Object.assign({},t,e,Object.fromEntries(o.map(s=>[s,n(t[s],e[s])])))}curry((t,e)=>t*e);curry((t,e)=>e.map(t));function drawLine(t,e=60){let n=0,o=fraction(0),s=[""],i="";for(;s[0].length<e;){const a=t.queryArc(n,n+1),l=a.filter(u=>u.hasOnset()).map(u=>u.duration),c=gcd(...l),p=c.inverse();s=s.map(u=>u+"|"),i+="|";for(let u=0;u<p;u++){const[f,d]=[o,o.add(c)],m=a.filter(k=>k.whole.begin.lte(f)&&k.whole.end.gte(d)),_=m.length-s.length;_>0&&(s=s.concat(Array(_).fill(i))),s=s.map((k,v)=>{const q=m[v];if(q){const b=q.whole.begin.eq(f)?""+q.value:"-";return k+b}return k+"."}),i+=".",o=o.add(c)}n++}return s.join(`
`)}const logKey="strudel.log";function logger(t,e,n={}){console.log(`%c${t}`,"background-color: black;color:white;border-radius:15px"),typeof document<"u"&&typeof CustomEvent<"u"&&document.dispatchEvent(new CustomEvent(logKey,{detail:{message:t,type:e,data:n}}))}logger.key=logKey;let stringParser;const setStringParser=t=>stringParser=t;class Pattern{constructor(e){this.query=e,this._Pattern=!0}withValue(e){return new Pattern(n=>this.query(n).map(o=>o.withValue(e)))}fmap(e){return this.withValue(e)}appWhole(e,n){const o=this,s=function(i){const a=o.query(i),l=n.query(i),c=function(p,u){const f=p.part.intersection(u.part);if(f!=null)return new Hap(e(p.whole,u.whole),f,p.value(u.value),u.combineContext(p))};return flatten(a.map(p=>removeUndefineds(l.map(u=>c(p,u)))))};return new Pattern(s)}appBoth(e){const n=function(o,s){if(!(o==null||s==null))return o.intersection_e(s)};return this.appWhole(n,e)}appLeft(e){const n=this,o=function(s){const i=[];for(const a of n.query(s)){const l=e.query(s.setSpan(a.wholeOrPart()));for(const c of l){const p=a.whole,u=a.part.intersection(c.part);if(u){const f=a.value(c.value),d=c.combineContext(a),m=new Hap(p,u,f,d);i.push(m)}}}return i};return new Pattern(o)}appRight(e){const n=this,o=function(s){const i=[];for(const a of e.query(s)){const l=n.query(s.setSpan(a.wholeOrPart()));for(const c of l){const p=a.whole,u=c.part.intersection(a.part);if(u){const f=c.value(a.value),d=a.combineContext(c),m=new Hap(p,u,f,d);i.push(m)}}}return i};return new Pattern(o)}bindWhole(e,n){const o=this,s=function(i){const a=function(c,p){return new Hap(e(c.whole,p.whole),p.part,p.value,Object.assign({},c.context,p.context,{locations:(c.context.locations||[]).concat(p.context.locations||[])}))},l=function(c){return n(c.value).query(i.setSpan(c.part)).map(p=>a(c,p))};return flatten(o.query(i).map(c=>l(c)))};return new Pattern(s)}bind(e){const n=function(o,s){if(!(o==null||s==null))return o.intersection_e(s)};return this.bindWhole(n,e)}join(){return this.bind(id)}outerBind(e){return this.bindWhole(n=>n,e)}outerJoin(){return this.outerBind(id)}innerBind(e){return this.bindWhole((n,o)=>o,e)}innerJoin(){return this.innerBind(id)}trigJoin(e=!1){const n=this;return new Pattern(o=>n.discreteOnly().query(o).map(s=>s.value.late(e?s.whole.begin:s.whole.begin.cyclePos()).query(o).map(i=>new Hap(i.whole?i.whole.intersection(s.whole):void 0,i.part.intersection(s.part),i.value).setContext(s.combineContext(i))).filter(i=>i.part)).flat())}trigzeroJoin(){return this.trigJoin(!0)}squeezeJoin(){const e=this;function n(o){const s=e.discreteOnly().query(o);function i(l){const p=l.value._focusSpan(l.wholeOrPart()).query(o.setSpan(l.part));function u(f,d){let m;if(d.whole&&f.whole&&(m=d.whole.intersection(f.whole),!m))return;const _=d.part.intersection(f.part);if(!_)return;const k=d.combineContext(f);return new Hap(m,_,d.value,k)}return p.map(f=>u(l,f))}return flatten(s.map(i)).filter(l=>l)}return new Pattern(n)}squeezeBind(e){return this.fmap(e).squeezeJoin()}queryArc(e,n){try{return this.query(new State(new TimeSpan(e,n)))}catch(o){return logger(`[query]: ${o.message}`,"error"),[]}}splitQueries(){const e=this,n=o=>flatten(o.span.spanCycles.map(s=>e.query(o.setSpan(s))));return new Pattern(n)}withQuerySpan(e){return new Pattern(n=>this.query(n.withSpan(e)))}withQuerySpanMaybe(e){const n=this;return new Pattern(o=>{const s=o.withSpan(e);return s.span?n.query(s):[]})}withQueryTime(e){return new Pattern(n=>this.query(n.withSpan(o=>o.withTime(e))))}withHapSpan(e){return new Pattern(n=>this.query(n).map(o=>o.withSpan(e)))}withHapTime(e){return this.withHapSpan(n=>n.withTime(e))}withHaps(e){return new Pattern(n=>e(this.query(n)))}withHap(e){return this.withHaps(n=>n.map(e))}setContext(e){return this.withHap(n=>n.setContext(e))}withContext(e){return this.withHap(n=>n.setContext(e(n.context)))}stripContext(){return this.withHap(e=>e.setContext({}))}withLocation(e,n){const o={start:{line:e[0],column:e[1],offset:e[2]},end:{line:n[0],column:n[1],offset:n[2]}};return this.withContext(s=>{const i=(s.locations||[]).concat([o]);return{...s,locations:i}})}withMiniLocation(e,n){const o={start:{line:e[0],column:e[1],offset:e[2]},end:{line:n[0],column:n[1],offset:n[2]}};return this.withContext(s=>{let i=s.locations||[];return i=i.map(({start:a,end:l})=>{const c=a.line===1?o.start.column:0;return{start:{...a,line:a.line-1+(o.start.line-1)+1,column:a.column-1+c},end:{...l,line:l.line-1+(o.start.line-1)+1,column:l.column-1+c}}}),{...s,locations:i}})}filterHaps(e){return new Pattern(n=>this.query(n).filter(e))}filterValues(e){return new Pattern(n=>this.query(n).filter(o=>e(o.value)))}removeUndefineds(){return this.filterValues(e=>e!=null)}onsetsOnly(){return this.filterHaps(e=>e.hasOnset())}discreteOnly(){return this.filterHaps(e=>e.whole)}defragmentHaps(){return this.discreteOnly().withHaps(n=>{const o=[];for(var s=0;s<n.length;++s){for(var i=!0,a=n[s];i;){const p=JSON.stringify(n[s].value);for(var l=!1,c=s+1;c<n.length;c++){const u=n[c];if(a.whole.equals(u.whole)){if(a.part.begin.eq(u.part.end)){if(p===JSON.stringify(u.value)){a=new Hap(a.whole,new TimeSpan(u.part.begin,a.part.end),a.value),n.splice(c,1),l=!0;break}}else if(u.part.begin.eq(a.part.end)&&p==JSON.stringify(u.value)){a=new Hap(a.whole,new TimeSpan(a.part.begin,u.part.end),a.value),n.splice(c,1),l=!0;break}}}i=l}o.push(a)}return o})}firstCycle(e=!1){var n=this;return e||(n=n.stripContext()),n.query(new State(new TimeSpan(fraction(0),fraction(1))))}get firstCycleValues(){return this.firstCycle().map(e=>e.value)}get showFirstCycle(){return this.firstCycle().map(e=>`${e.value}: ${e.whole.begin.toFraction()} - ${e.whole.end.toFraction()}`)}sortHapsByPart(){return this.withHaps(e=>e.sort((n,o)=>n.part.begin.sub(o.part.begin).or(n.part.end.sub(o.part.end)).or(n.whole.begin.sub(o.whole.begin).or(n.whole.end.sub(o.whole.end)))))}asNumber(){return this.fmap(parseNumeral)}_opIn(e,n){return this.fmap(n).appLeft(reify(e))}_opOut(e,n){return this.fmap(n).appRight(reify(e))}_opMix(e,n){return this.fmap(n).appBoth(reify(e))}_opSqueeze(e,n){const o=reify(e);return this.fmap(s=>o.fmap(i=>n(s)(i))).squeezeJoin()}_opSqueezeOut(e,n){const o=this;return reify(e).fmap(i=>o.fmap(a=>n(a)(i))).squeezeJoin()}_opTrig(e,n){return reify(e).fmap(s=>this.fmap(i=>n(i)(s))).trigJoin()}_opTrigzero(e,n){return reify(e).fmap(s=>this.fmap(i=>n(i)(s))).trigzeroJoin()}layer(...e){return stack(...e.map(n=>n(this)))}superimpose(...e){return this.stack(...e.map(n=>n(this)))}stack(...e){return stack(this,...e)}sequence(...e){return sequence(this,...e)}seq(...e){return sequence(this,...e)}cat(...e){return cat(this,...e)}fastcat(...e){return fastcat(this,...e)}slowcat(...e){return slowcat(this,...e)}onTrigger(e,n=!0){return this.withHap(o=>o.setContext({...o.context,onTrigger:(...s)=>{!n&&o.context.onTrigger&&o.context.onTrigger(...s),e(...s)},dominantTrigger:n}))}log(e=(o,s)=>`[hap] ${s.showWhole(!0)}`,n=(o,s)=>({hap:s})){return this.onTrigger((...o)=>{logger(e(...o),void 0,n(...o))},!1)}logValues(e=id){return this.log((n,o)=>e(o.value))}drawLine(){return console.log(drawLine(this)),this}}function groupHapsBy(t,e){let n=[];return e.forEach(o=>{const s=n.findIndex(([i])=>t(o,i));s===-1?n.push([o]):n[s].push(o)}),n}const congruent=(t,e)=>t.spanEquals(e);Pattern.prototype.collect=function(){return this.withHaps(t=>groupHapsBy(congruent,t).map(e=>new Hap(e[0].whole,e[0].part,e,{})))};Pattern.prototype.arpWith=function(t){return this.collect().fmap(e=>reify(t(e))).innerJoin().withHap(e=>new Hap(e.whole,e.part,e.value.value,e.combineContext(e.value)))};Pattern.prototype.arp=function(t){return this.arpWith(e=>t.fmap(n=>e[n%e.length]))};function _composeOp(t,e,n){function o(s){return s instanceof Object&&!(s instanceof Function)}return o(t)||o(e)?(o(t)||(t={value:t}),o(e)||(e={value:e}),unionWithObj(t,e,n)):n(t,e)}(function(){const t={set:[(n,o)=>o],keep:[n=>n],keepif:[(n,o)=>o?n:void 0],add:[numeralArgs((n,o)=>n+o)],sub:[numeralArgs((n,o)=>n-o)],mul:[numeralArgs((n,o)=>n*o)],div:[numeralArgs((n,o)=>n/o)],mod:[numeralArgs(_mod)],pow:[numeralArgs(Math.pow)],band:[numeralArgs((n,o)=>n&o)],bor:[numeralArgs((n,o)=>n|o)],bxor:[numeralArgs((n,o)=>n^o)],blshift:[numeralArgs((n,o)=>n<<o)],brshift:[numeralArgs((n,o)=>n>>o)],lt:[(n,o)=>n<o],gt:[(n,o)=>n>o],lte:[(n,o)=>n<=o],gte:[(n,o)=>n>=o],eq:[(n,o)=>n==o],eqt:[(n,o)=>n===o],ne:[(n,o)=>n!=o],net:[(n,o)=>n!==o],and:[(n,o)=>n&&o],or:[(n,o)=>n||o],func:[(n,o)=>o(n)]},e=["In","Out","Mix","Squeeze","SqueezeOut","Trig","Trigzero"];for(const[n,[o,s]]of Object.entries(t)){Pattern.prototype["_"+n]=function(i){return this.fmap(a=>o(a,i))},Object.defineProperty(Pattern.prototype,n,{get:function(){const i=this,a=(...l)=>i[n].in(...l);for(const l of e)a[l.toLowerCase()]=function(...c){var p=i;c=sequence(c),s&&(p=s(p),c=s(c));var u;return n==="keepif"?(u=p["_op"+l](c,f=>d=>o(f,d)),u=u.removeUndefineds()):u=p["_op"+l](c,f=>d=>_composeOp(f,d,o)),u};return a.squeezein=a.squeeze,a}});for(const i of e)Pattern.prototype[i.toLowerCase()]=function(...a){return this.set[i.toLowerCase()](a)}}Pattern.prototype.struct=function(...n){return this.keepif.out(...n)},Pattern.prototype.structAll=function(...n){return this.keep.out(...n)},Pattern.prototype.mask=function(...n){return this.keepif.in(...n)},Pattern.prototype.maskAll=function(...n){return this.keep.in(...n)},Pattern.prototype.reset=function(...n){return this.keepif.trig(...n)},Pattern.prototype.resetAll=function(...n){return this.keep.trig(...n)},Pattern.prototype.restart=function(...n){return this.keepif.trigzero(...n)},Pattern.prototype.restartAll=function(...n){return this.keep.trigzero(...n)}})();const polyrhythm=stack,pr=stack,pm=polymeter;Pattern.prototype.factories={pure,stack,slowcat,fastcat,cat,timeCat,sequence,seq,polymeter,pm,polyrhythm,pr};const silence=new Pattern(()=>[]);function pure(t){function e(n){return n.span.spanCycles.map(o=>new Hap(fraction(o.begin).wholeCycle(),o,t))}return new Pattern(e)}function isPattern(t){return t instanceof Pattern||t?._Pattern}function reify(t){return isPattern(t)?t:stringParser&&typeof t=="string"?stringParser(t):pure(t)}function stack(...t){t=t.map(n=>Array.isArray(n)?sequence(...n):reify(n));const e=n=>flatten(t.map(o=>o.query(n)));return new Pattern(e)}function slowcat(...t){t=t.map(n=>Array.isArray(n)?sequence(...n):reify(n));const e=function(n){const o=n.span,s=_mod(o.begin.sam(),t.length),i=t[s];if(!i)return[];const a=o.begin.floor().sub(o.begin.div(t.length).floor());return i.withHapTime(l=>l.add(a)).query(n.setSpan(o.withTime(l=>l.sub(a))))};return new Pattern(e).splitQueries()}function slowcatPrime(...t){t=t.map(reify);const e=function(n){const o=Math.floor(n.span.begin)%t.length;return t[o]?.query(n)||[]};return new Pattern(e).splitQueries()}function cat(...t){return slowcat(...t)}function timeCat(...t){const e=t.map(s=>s[0]).reduce((s,i)=>s.add(i),fraction(0));let n=fraction(0);const o=[];for(const[s,i]of t){const a=n.add(s);o.push(reify(i)._compress(n.div(e),a.div(e))),n=a}return stack(...o)}function arrange(...t){const e=t.reduce((n,[o])=>n+o,0);return t=t.map(([n,o])=>[n,o.fast(n)]),timeCat(...t).slow(e)}function fastcat(...t){return slowcat(...t)._fast(t.length)}function sequence(...t){return fastcat(...t)}function seq(...t){return fastcat(...t)}function _sequenceCount(t){return Array.isArray(t)?t.length==0?[silence,0]:t.length==1?_sequenceCount(t[0]):[fastcat(...t.map(e=>_sequenceCount(e)[0])),t.length]:[reify(t),1]}function polymeterSteps(t,...e){const n=e.map(s=>_sequenceCount(s));if(n.length==0)return silence;t==0&&(t=n[0][1]);const o=[];for(const s of n)s[1]!=0&&(t==s[1]?o.push(s[0]):o.push(s[0]._fast(fraction(t).div(fraction(s[1])))));return stack(...o)}function polymeter(...t){return polymeterSteps(0,...t)}const mask=curry((t,e)=>reify(e).mask(t)),struct=curry((t,e)=>reify(e).struct(t)),superimpose=curry((t,e)=>reify(e).superimpose(...t)),set=curry((t,e)=>reify(e).set(t)),keep=curry((t,e)=>reify(e).keep(t)),keepif=curry((t,e)=>reify(e).keepif(t)),add=curry((t,e)=>reify(e).add(t)),sub=curry((t,e)=>reify(e).sub(t)),mul=curry((t,e)=>reify(e).mul(t)),div=curry((t,e)=>reify(e).div(t)),mod=curry((t,e)=>reify(e).mod(t)),pow=curry((t,e)=>reify(e).pow(t)),band=curry((t,e)=>reify(e).band(t)),bor=curry((t,e)=>reify(e).bor(t)),bxor=curry((t,e)=>reify(e).bxor(t)),blshift=curry((t,e)=>reify(e).blshift(t)),brshift=curry((t,e)=>reify(e).brshift(t)),lt=curry((t,e)=>reify(e).lt(t)),gt=curry((t,e)=>reify(e).gt(t)),lte=curry((t,e)=>reify(e).lte(t)),gte=curry((t,e)=>reify(e).gte(t)),eq=curry((t,e)=>reify(e).eq(t)),eqt=curry((t,e)=>reify(e).eqt(t)),ne=curry((t,e)=>reify(e).ne(t)),net=curry((t,e)=>reify(e).net(t)),and=curry((t,e)=>reify(e).and(t)),or=curry((t,e)=>reify(e).or(t)),func=curry((t,e)=>reify(e).func(t));function register(t,e,n=!0){if(Array.isArray(t)){const i={};for(const a of t)i[a]=register(a,e,n);return i}const o=e.length;var s;return n?s=function(...i){i=i.map(reify);const a=i[i.length-1];if(o===1)return e(a);const[l,...c]=i.slice(0,-1);let p=(...u)=>(Array(o-1).fill().map((f,d)=>u[d]??void 0),e(...u,a));return p=curry(p,null,o-1),c.reduce((u,f)=>u.appLeft(f),l.fmap(p)).innerJoin()}:s=function(...i){return i=i.map(reify),e(...i)},Pattern.prototype[t]=function(...i){if(o===2&&i.length!==1)i=[sequence(...i)];else if(o!==i.length+1)throw new Error(`.${t}() expects ${o-1} inputs but got ${i.length}.`);return i=i.map(reify),s(...i,this)},o>1&&(Pattern.prototype["_"+t]=function(...i){return e(...i,this)}),curry(s,null,o)}const round=register("round",function(t){return t.asNumber().fmap(e=>Math.round(e))}),floor=register("floor",function(t){return t.asNumber().fmap(e=>Math.floor(e))}),ceil=register("ceil",function(t){return t.asNumber().fmap(e=>Math.ceil(e))}),toBipolar=register("toBipolar",function(t){return t.fmap(e=>e*2-1)}),fromBipolar=register("fromBipolar",function(t){return t.fmap(e=>(e+1)/2)}),range=register("range",function(t,e,n){return n.mul(e-t).add(t)}),rangex=register("rangex",function(t,e,n){return n._range(Math.log(t),Math.log(e)).fmap(Math.exp)}),range2=register("range2",function(t,e,n){return n.fromBipolar()._range(t,e)}),ratio=register("ratio",t=>t.fmap(e=>Array.isArray(e)?e.slice(1).reduce((n,o)=>n/o,e[0]):e)),compress=register("compress",function(t,e,n){return t=fraction(t),e=fraction(e),t.gt(e)||t.gt(1)||e.gt(1)||t.lt(0)||e.lt(0)?silence:n._fastGap(fraction(1).div(e.sub(t)))._late(t)}),{compressSpan,compressspan}=register(["compressSpan","compressspan"],function(t,e){return e._compress(t.begin,t.end)}),{fastGap,fastgap}=register(["fastGap","fastgap"],function(t,e){const n=function(s){const i=s.begin.sam(),a=s.begin.sub(i).mul(t).min(1),l=s.end.sub(i).mul(t).min(1);if(!(a>=1))return new TimeSpan(i.add(a),i.add(l))},o=function(s){const i=s.part.begin,a=s.part.end,l=i.sam(),c=i.sub(l).div(t).min(1),p=a.sub(l).div(t).min(1),u=new TimeSpan(l.add(c),l.add(p)),f=s.whole?new TimeSpan(u.begin.sub(i.sub(s.whole.begin).div(t)),u.end.add(s.whole.end.sub(a).div(t))):void 0;return new Hap(f,u,s.value,s.context)};return e.withQuerySpanMaybe(n).withHap(o).splitQueries()}),focus=register("focus",function(t,e,n){return t=fraction(t),e=fraction(e),n._fast(fraction(1).div(e.sub(t))).late(t.cyclePos())}),{focusSpan,focusspan}=register(["focusSpan","focusspan"],function(t,e){return e._focus(t.begin,t.end)}),ply=register("ply",function(t,e){return e.fmap(n=>pure(n)._fast(t)).squeezeJoin()}),{fast,density}=register(["fast","density"],function(t,e){return t===0?silence:(t=fraction(t),e.withQueryTime(o=>o.mul(t)).withHapTime(o=>o.div(t)))}),hurry=register("hurry",function(t,e){return e._fast(t).mul(pure({speed:t}))}),{slow,sparsity}=register(["slow","sparsity"],function(t,e){return t===0?silence:e._fast(fraction(1).div(t))}),inside=register("inside",function(t,e,n){return e(n._slow(t))._fast(t)}),outside=register("outside",function(t,e,n){return e(n._fast(t))._slow(t)}),lastOf=register("lastOf",function(t,e,n){const o=Array(t-1).fill(n);return o.push(e(n)),slowcatPrime(...o)}),{firstOf,every}=register(["firstOf","every"],function(t,e,n){const o=Array(t-1).fill(n);return o.unshift(e(n)),slowcatPrime(...o)}),apply=register("apply",function(t,e){return t(e)}),cpm=register("cpm",function(t,e){return e._fast(t/60)}),early=register("early",function(t,e){return t=fraction(t),e.withQueryTime(n=>n.add(t)).withHapTime(n=>n.sub(t))}),late=register("late",function(t,e){return t=fraction(t),e._early(fraction(0).sub(t))}),zoom=register("zoom",function(t,e,n){e=fraction(e),t=fraction(t);const o=e.sub(t);return n.withQuerySpan(s=>s.withCycle(i=>i.mul(o).add(t))).withHapSpan(s=>s.withCycle(i=>i.sub(t).div(o))).splitQueries()}),{zoomArc,zoomarc}=register(["zoomArc","zoomarc"],function(t,e){return e.zoom(t.begin,t.end)}),linger=register("linger",function(t,e){return t==0?silence:t<0?e._zoom(t.add(1),1)._slow(t):e._zoom(0,t)._slow(t)}),segment=register("segment",function(t,e){return e.struct(pure(!0)._fast(t))}),{invert,inv}=register(["invert","inv"],function(t){return t.fmap(e=>!e)}),when=register("when",function(t,e,n){return t?e(n):n}),off=register("off",function(t,e,n){return stack(n,e(n.late(t)))}),brak=register("brak",function(t){return t.when(slowcat(!1,!0),e=>fastcat(e,silence)._late(.25))}),rev=register("rev",function(t){const e=function(n){const o=n.span,s=o.begin.sam(),i=o.begin.nextSam(),a=function(c){const p=c.withTime(f=>s.add(i.sub(f))),u=p.begin;return p.begin=p.end,p.end=u,p};return t.query(n.setSpan(a(o))).map(c=>c.withSpan(a))};return new Pattern(e).splitQueries()}),pressBy=register("pressBy",function(t,e){return e.fmap(n=>pure(n).compress(t,1)).squeezeJoin()}),press=register("press",function(t){return t._pressBy(.5)}),hush=register("hush",function(t){return silence}),palindrome=register("palindrome",function(t){return t.every(2,rev)}),{juxBy,juxby}=register(["juxBy","juxby"],function(t,e,n){t/=2;const o=function(a,l,c){return l in a?a[l]:c},s=n.withValue(a=>Object.assign({},a,{pan:o(a,"pan",.5)-t})),i=n.withValue(a=>Object.assign({},a,{pan:o(a,"pan",.5)+t}));return stack(s,e(i))}),jux=register("jux",function(t,e){return e._juxBy(1,t,e)}),{echoWith,echowith,stutWith,stutwith}=register(["echoWith","echowith","stutWith","stutwith"],function(t,e,n,o){return stack(...listRange(0,t-1).map(s=>n(o.late(fraction(e).mul(s)),s)))}),echo=register("echo",function(t,e,n,o){return o._echoWith(t,e,(s,i)=>s.velocity(Math.pow(n,i)))}),stut=register("stut",function(t,e,n,o){return o._echoWith(t,n,(s,i)=>s.velocity(Math.pow(e,i)))}),_iter=function(t,e,n=!1){return t=fraction(t),slowcat(...listRange(0,t.sub(1)).map(o=>n?e.late(fraction(o).div(t)):e.early(fraction(o).div(t))))},iter=register("iter",function(t,e){return _iter(t,e,!1)}),{iterBack,iterback}=register(["iterBack","iterback"],function(t,e){return _iter(t,e,!0)}),_chunk=function(t,e,n,o=!1){const s=Array(t-1).fill(!1);s.unshift(!0);const i=_iter(t,sequence(...s),o);return n.when(i,e)},chunk=register("chunk",function(t,e,n){return _chunk(t,e,n,!1)}),{chunkBack,chunkback}=register(["chunkBack","chunkback"],function(t,e,n){return _chunk(t,e,n,!0)}),bypass=register("bypass",function(t,e){return t=!!parseInt(t),t?silence:e}),ribbon=register("ribbon",(t,e,n)=>n.early(t).restart(pure(1).slow(e))),duration=register("duration",function(t,e){return e.withHapSpan(n=>new TimeSpan(n.begin,n.begin.add(t)))}),{color,colour}=register(["color","colour"],function(t,e){return e.withContext(n=>({...n,color:t}))}),velocity=register("velocity",function(t,e){return e.withContext(n=>({...n,velocity:(n.velocity||1)*t}))}),legato=register("legato",function(t,e){return t=fraction(t),e.withHapSpan(n=>new TimeSpan(n.begin,n.begin.add(n.end.sub(n.begin).mul(t))))}),chop=register("chop",function(t,e){const o=Array.from({length:t},(i,a)=>a).map(i=>({begin:i/t,end:(i+1)/t})),s=function(i){return sequence(o.map(a=>Object.assign({},i,a)))};return e.squeezeBind(s)}),striate=register("striate",function(t,e){const o=Array.from({length:t},(i,a)=>a).map(i=>({begin:i/t,end:(i+1)/t})),s=slowcat(...o);return e.set(s)._fast(t)}),_loopAt=function(t,e,n=1){return e.speed(1/t*n).unit("c").slow(t)},slice=register("slice",function(t,e,n){return t.innerBind(o=>e.outerBind(s=>n.outerBind(i=>{i=i instanceof Object?i:{s:i};const a={begin:s/o,end:(s+1)/o,_slices:o};return pure({...a,...i})})))},!1),splice=register("splice",function(t,e,n){return slice(t,e,n).withHap(function(s){return s.withValue(i=>({speed:1/i._slices/s.whole.duration*(i.speed||1),unit:"c",...i}))})},!1),{loopAt,loopat}=register(["loopAt","loopat"],function(t,e){return _loopAt(t,e,1)}),{loopAtCps,loopatcps}=register(["loopAtCps","loopatcps"],function(t,e,n){return _loopAt(t,n,e)}),controls={},generic_params=[[["s","n","gain"],"sound"],["source","src"],["n"],[["note","n"]],["accelerate"],["gain"],["amp"],["attack","att"],["bank"],["decay"],["sustain","sus"],["release","rel"],["hold"],[["bandf","bandq"],"bpf","bp"],["bandq","bpq"],["begin"],["end"],["loop"],["crush"],["coarse"],["channel"],["cut"],[["cutoff","resonance"],"ctf","lpf","lp"],[["hcutoff","hresonance"],"hpf","hp"],["hresonance","hpq"],["resonance","lpq"],["djf"],[["delay","delaytime","delayfeedback"]],["delayfeedback","delayfb","dfb"],["delaytime","delayt","dt"],["lock"],["detune","det"],["dry"],["fadeTime","fadeOutTime"],["fadeInTime"],["freq"],["gate","gat"],["leslie"],["lrate"],["lsize"],["degree"],["mtranspose"],["ctranspose"],["harmonic"],["stepsPerOctave"],["octaveR"],["nudge"],["octave"],["offset"],["orbit"],["overgain"],["overshape"],["pan"],["panspan"],["pansplay"],["panwidth"],["panorient"],["rate"],["slide"],["semitone"],["voice"],[["room","size"]],["size","sz","roomsize"],["shape"],["speed"],["unit"],["squiz"],["vowel"],["waveloss"],["dur"],["expression"],["sustainpedal"],["tremolodepth","tremdp"],["tremolorate","tremr"],["phaserdepth","phasdp"],["phaserrate","phasr"],["fshift"],["fshiftnote"],["fshiftphase"],["triode"],["krush"],["kcutoff"],["octer"],["octersub"],["octersubsub"],["ring"],["ringf"],["ringdf"],["distort"],["freeze"],["xsdelay"],["tsdelay"],["real"],["imag"],["enhance"],["partials"],["comb"],["smear"],["scram"],["binshift"],["hbrick"],["lbrick"],["midichan"],["control"],["ccn"],["ccv"],["polyTouch"],["midibend"],["miditouch"],["ctlNum"],["frameRate"],["frames"],["hours"],["midicmd"],["minutes"],["progNum"],["seconds"],["songPtr"],["uid"],["val"],["cps"],["clip"]];controls.createParam=function(t){const e=Array.isArray(t)?t[0]:t;var n;Array.isArray(t)?n=i=>{if(Array.isArray(i)){const a={};return i.forEach((l,c)=>{c<t.length&&(a[t[c]]=l)}),a}else return{[e]:i}}:n=i=>({[e]:i});const o=(...i)=>sequence(...i).withValue(n),s=function(...i){return i.length?this.set(o(...i)):this.fmap(n)};return Pattern.prototype[e]=s,o};generic_params.forEach(([t,...e])=>{const n=Array.isArray(t)?t[0]:t;controls[n]=controls.createParam(t),e.forEach(o=>{controls[o]=controls[n],Pattern.prototype[o]=Pattern.prototype[n]})});controls.createParams=(...t)=>t.reduce((e,n)=>Object.assign(e,{[n]:controls.createParam(n)}),{});controls.adsr=register("adsr",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,o,s,i]=t;return e.set({attack:n,decay:o,sustain:s,release:i})});controls.ds=register("ds",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,o]=t;return e.set({decay:n,sustain:o})});const left=function(t,e){const[n,o]=t,[s,i]=e,[a,l]=splitAt(o,s);return[[o,n-o],[zipWith((c,p)=>c.concat(p),a,i),l]]},right=function(t,e){const[n,o]=t,[s,i]=e,[a,l]=splitAt(n,i);return[[n,o-n],[zipWith((p,u)=>p.concat(u),s,a),l]]},_bjork=function(t,e){const[n,o]=t;return Math.min(n,o)<=1?[t,e]:_bjork(...n>o?left(t,e):right(t,e))},bjork=function(t,e){const n=e-t,o=Array(t).fill([1]),s=Array(n).fill([0]),i=_bjork([t,n],[o,s]);return flatten(i[1][0]).concat(flatten(i[1][1]))},_euclidRot=function(t,e,n){const o=bjork(t,e);return n?rotate(o,-n):o},euclid=register("euclid",function(t,e,n){return n.struct(_euclidRot(t,e,0))}),{euclidrot,euclidRot}=register(["euclidrot","euclidRot"],function(t,e,n,o){return o.struct(_euclidRot(t,e,n))}),_euclidLegato=function(t,e,n,o){if(t<1)return silence;const i=_euclidRot(t,e,n).join("").split("1").slice(1).map(a=>[a.length+1,!0]);return o.struct(timeCat(...i))},euclidLegato=register(["euclidLegato"],function(t,e,n){return _euclidLegato(t,e,0,n)}),euclidLegatoRot=register(["euclidLegatoRot"],function(t,e,n,o){return _euclidLegato(t,e,n,o)});function steady(t){return new Pattern(e=>[new Hap(void 0,e.span,t)])}const signal=t=>{const e=n=>[new Hap(void 0,n.span,t(n.span.midpoint()))];return new Pattern(e)},isaw=signal(t=>1-t%1),isaw2=isaw.toBipolar(),saw=signal(t=>t%1),saw2=saw.toBipolar(),sine2=signal(t=>Math.sin(Math.PI*2*t)),sine=sine2.fromBipolar(),cosine=sine._early(fraction(1).div(4)),cosine2=sine2._early(fraction(1).div(4)),square=signal(t=>Math.floor(t*2%2)),square2=square.toBipolar(),tri=fastcat(isaw,saw),tri2=fastcat(isaw2,saw2),time$1=signal(id),xorwise=t=>{const e=t<<13^t,n=e>>17^e;return n<<5^n},_frac=t=>t-Math.trunc(t),timeToIntSeed=t=>xorwise(Math.trunc(_frac(t/300)*536870912)),intSeedToRand=t=>t%536870912/536870912,timeToRand=t=>Math.abs(intSeedToRand(timeToIntSeed(t))),run=t=>saw.range(0,t).floor().segment(t),rand=signal(timeToRand),rand2=rand.toBipolar(),_brandBy=t=>rand.fmap(e=>e<t),brandBy=t=>reify(t).fmap(_brandBy).innerJoin(),brand=_brandBy(.5),_irand=t=>rand.fmap(e=>Math.trunc(e*t)),irand=t=>reify(t).fmap(_irand).innerJoin(),__chooseWith=(t,e)=>(e=e.map(reify),e.length==0?silence:t.range(0,e.length).fmap(n=>e[Math.floor(n)])),chooseWith=(t,e)=>__chooseWith(t,e).outerJoin(),chooseInWith=(t,e)=>__chooseWith(t,e).innerJoin(),choose=(...t)=>chooseWith(rand,t);Pattern.prototype.choose=function(...t){return chooseWith(this,t)};Pattern.prototype.choose2=function(...t){return chooseWith(this.fromBipolar(),t)};const chooseCycles=(...t)=>chooseInWith(rand.segment(1),t),randcat=chooseCycles,_wchooseWith=function(t,...e){const n=e.map(l=>reify(l[0])),o=[];let s=0;for(const l of e)s+=l[1],o.push(s);const i=s,a=function(l){const c=l*i;return n[o.findIndex(p=>p>c,o)]};return t.fmap(a)},wchooseWith=(...t)=>_wchooseWith(...t).outerJoin(),wchoose=(...t)=>wchooseWith(rand,...t),wchooseCycles=(...t)=>_wchooseWith(rand,...t).innerJoin(),perlinWith=t=>{const e=t.fmap(Math.floor),n=t.fmap(i=>Math.floor(i)+1),o=i=>6*i**5-15*i**4+10*i**3,s=i=>a=>l=>a+o(i)*(l-a);return t.sub(e).fmap(s).appBoth(e.fmap(timeToRand)).appBoth(n.fmap(timeToRand))},perlin=perlinWith(time$1.fmap(t=>Number(t))),degradeByWith=register("degradeByWith",(t,e,n)=>n.fmap(o=>s=>o).appLeft(t.filterValues(o=>o>e))),degradeBy=register("degradeBy",function(t,e){return e._degradeByWith(rand,t)}),degrade=register("degrade",t=>t._degradeBy(.5)),undegradeBy=register("undegradeBy",function(t,e){return e._degradeByWith(rand.fmap(n=>1-n),t)}),undegrade=register("undegrade",t=>t._undegradeBy(.5)),sometimesBy=register("sometimesBy",function(t,e,n){return reify(t).fmap(o=>stack(n._degradeBy(o),e(n._undegradeBy(1-o)))).innerJoin()}),sometimes=register("sometimes",function(t,e){return e._sometimesBy(.5,t)}),someCyclesBy=register("someCyclesBy",function(t,e,n){return reify(t).fmap(o=>stack(n._degradeByWith(rand._segment(1),o),e(n._degradeByWith(rand.fmap(s=>1-s)._segment(1),1-o)))).innerJoin()}),someCycles=register("someCycles",function(t,e){return e._someCyclesBy(.5,t)}),often=register("often",function(t,e){return e.sometimesBy(.75,t)}),rarely=register("rarely",function(t,e){return e.sometimesBy(.25,t)}),almostNever=register("almostNever",function(t,e){return e.sometimesBy(.1,t)}),almostAlways=register("almostAlways",function(t,e){return e.sometimesBy(.9,t)}),never=register("never",function(t,e){return e}),always=register("always",function(t,e){return t(e)});let synth;try{synth=window?.speechSynthesis}catch{console.warn("cannot use window: not in browser?")}let allVoices=synth?.getVoices();function triggerSpeech(t,e,n){synth.cancel();const o=new SpeechSynthesisUtterance(t);o.lang=e,allVoices=synth.getVoices();const s=allVoices.filter(i=>i.lang.includes(e));typeof n=="number"?o.voice=s[n%s.length]:typeof n=="string"&&(o.voice=s.find(i=>i.name===i)),speechSynthesis.speak(o)}const speak=register("speak",function(t,e,n){return n.onTrigger((o,s)=>{triggerSpeech(s.value,t,e)})}),evalScope=async(...t)=>{const e=await Promise.allSettled(t),n=e.filter(o=>o.status==="fulfilled").map(o=>o.value);e.forEach((o,s)=>{o.status==="rejected"&&console.warn(`evalScope: module with index ${s} could not be loaded:`,o.reason)}),n.forEach(o=>{Object.entries(o).forEach(([s,i])=>{globalThis[s]=i})})};function safeEval(t,e={}){const{wrapExpression:n=!0,wrapAsync:o=!0}=e;n&&(t=`{${t}}`),o&&(t=`(async ()=>${t})()`);const s=`"use strict";return (${t})`;return Function(s)()}const evaluate=async(t,e)=>{e&&(t=e(t));let o=await safeEval(t,{wrapExpression:!!e});if(!isPattern(o)){console.log("evaluated",o);const s=`got "${typeof o}" instead of pattern`;throw new Error(s+(typeof o=="function"?", did you forget to call a function?":"."))}return{mode:"javascript",pattern:o}};function createClock(t,e,n=.05,o=.1,s=.1){let i=0,a=0,l=10**4,c=.01;const p=q=>n=q(n);s=s||o/2;const u=()=>{const q=t(),C=q+o+s;for(a===0&&(a=q+c);a<C;)a=Math.round(a*l)/l,a>=q&&e(a,n,i),a<q&&console.log("TOO LATE",a),a+=n,i++};let f;const d=()=>{m(),u(),f=setInterval(u,o*1e3)},m=()=>f!==void 0&&clearInterval(f);return{setDuration:p,start:d,stop:()=>{i=0,a=0,m()},pause:()=>m(),duration:n,interval:o,getPhase:()=>a,minLatency:c}}class Cyclist{constructor({interval:e,onTrigger:n,onToggle:o,onError:s,getTime:i,latency:a=.1}){this.started=!1,this.cps=1,this.lastTick=0,this.lastBegin=0,this.lastEnd=0,this.getTime=i,this.onToggle=o,this.latency=a;const l=c=>Math.round(c*1e3)/1e3;this.clock=createClock(i,(c,p,u)=>{u===0&&(this.origin=c);try{const f=i(),d=this.lastEnd;this.lastBegin=d;const m=l(d+p*this.cps);this.lastEnd=m;const _=this.pattern.queryArc(d,m),k=c-f;this.lastTick=f+k,_.forEach(v=>{if(v.part.begin.equals(v.whole.begin)){const q=(v.whole.begin-d)/this.cps+k+a,C=v.duration/this.cps;n?.(v,q,C,this.cps)}})}catch(f){logger(`[cyclist] error: ${f.message}`),s?.(f)}},e)}now(){const e=this.getTime()-this.lastTick-this.clock.duration;return this.lastBegin+e*this.cps}setStarted(e){this.started=e,this.onToggle?.(e)}start(){if(!this.pattern)throw new Error("Scheduler: no pattern set! call .setPattern first.");logger("[cyclist] start"),this.clock.start(),this.setStarted(!0)}pause(){logger("[cyclist] pause"),this.clock.pause(),this.setStarted(!1)}stop(){logger("[cyclist] stop"),this.clock.stop(),this.lastEnd=0,this.setStarted(!1)}setPattern(e,n=!1){this.pattern=e,n&&!this.started&&this.start()}setCps(e=1){this.cps=e}log(e,n,o){const s=o.filter(i=>i.hasOnset());console.log(`${e.toFixed(4)} - ${n.toFixed(4)} ${Array(s.length).fill("I").join("")}`)}}let time;function getTime(){if(!time)throw new Error("no time set! use setTime to define a time source");return time()}function setTime(t){time=t}function repl({interval:t,defaultOutput:e,onSchedulerError:n,onEvalError:o,beforeEval:s,afterEval:i,getTime:a,transpiler:l,onToggle:c,editPattern:p}){const u=new Cyclist({interval:t,onTrigger:getTrigger({defaultOutput:e,getTime:a}),onError:n,getTime:a,onToggle:c}),f=(A,P=!0)=>{A=p?.(A)||A,u.setPattern(A,P)};setTime(()=>u.now());const d=async(A,P=!0)=>{if(!A)throw new Error("no code to evaluate");try{await s?.({code:A});let{pattern:T}=await evaluate(A,l);return logger("[eval] code updated"),f(T,P),i?.({code:A,pattern:T}),T}catch(T){logger(`[eval] error: ${T.message}`,"error"),o?.(T)}},m=()=>u.stop(),_=()=>u.start(),k=()=>u.pause(),v=A=>u.setCps(A),q=A=>u.setCps(A/60),C=register("loopAt",(A,P)=>P.loopAtCps(A,u.cps)),b=register("fit",A=>A.withHap(P=>P.withValue(T=>({...T,speed:u.cps/P.whole.duration,unit:"c"}))));return evalScope({loopAt:C,fit:b,setCps:v,setcps:v,setCpm:q,setcpm:q}),{scheduler:u,evaluate:d,start:_,stop:m,pause:k,setCps:v,setPattern:f}}const getTrigger=({getTime:t,defaultOutput:e})=>async(n,o,s,i)=>{try{(!n.context.onTrigger||!n.context.dominantTrigger)&&await e(n,o,s,i),n.context.onTrigger&&await n.context.onTrigger(t()+o,n,t(),i)}catch(a){logger(`[cyclist] error: ${a.message}`,"error")}},getDrawContext=(t="test-canvas")=>{let e=document.querySelector("#"+t);return e||(e=document.createElement("canvas"),e.id=t,e.width=window.innerWidth,e.height=window.innerHeight,e.style="pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0",document.body.prepend(e)),e.getContext("2d")};Pattern.prototype.draw=function(t,{from:e,to:n,onQuery:o}){window.strudelAnimation&&cancelAnimationFrame(window.strudelAnimation);const s=getDrawContext();let i,a=[];const l=c=>{const p=getTime();if(e!==void 0&&n!==void 0){const u=Math.floor(p);if(i!==u){i=u;const f=u+e,d=u+n;setTimeout(()=>{a=this.query(new State(new TimeSpan(f,d))).filter(Boolean).filter(m=>m.part.begin.equals(m.whole.begin)),o?.(a)},0)}}t(s,a,p,c),window.strudelAnimation=requestAnimationFrame(l)};return requestAnimationFrame(l),this};const cleanupDraw=(t=!0)=>{const e=getDrawContext();t&&e.clearRect(0,0,window.innerWidth,window.innerHeight),window.strudelAnimation&&cancelAnimationFrame(window.strudelAnimation),window.strudelScheduler&&clearInterval(window.strudelScheduler)};Pattern.prototype.onPaint=function(t){return this.context={onPaint:t},this};class Framer{constructor(e,n){this.onFrame=e,this.onError=n}start(){const e=this;let n=requestAnimationFrame(function o(s){try{e.onFrame(s)}catch(i){e.onError(i)}n=requestAnimationFrame(o)});e.cancel=()=>{cancelAnimationFrame(n)}}stop(){this.cancel&&this.cancel()}}class Drawer{constructor(e,n){let[o,s]=n;o=Math.abs(o),this.visibleHaps=[],this.lastFrame=null,this.drawTime=n,this.framer=new Framer(()=>{if(!this.scheduler){console.warn("Drawer: no scheduler");return}const i=this.scheduler.now()+s;if(this.lastFrame===null){this.lastFrame=i;return}const a=this.scheduler.pattern.queryArc(Math.max(this.lastFrame,i-1/10),i);this.lastFrame=i,this.visibleHaps=(this.visibleHaps||[]).filter(c=>c.whole.end>=i-o-s).concat(a.filter(c=>c.hasOnset()));const l=i-s;e(this.visibleHaps,l,this)},i=>{console.warn("draw error",i)})}invalidate(e=this.scheduler){if(!e)return;this.scheduler=e;const n=e.now();let[o,s]=this.drawTime;const[i,a]=[Math.max(n,0),n+s+.1];this.visibleHaps=this.visibleHaps.filter(c=>c.whole.begin<n);const l=e.pattern.queryArc(i,a);this.visibleHaps=this.visibleHaps.concat(l)}start(e){this.scheduler=e,this.invalidate(),this.framer.start()}stop(){this.framer&&this.framer.stop()}}const{createParams}=controls;let clearColor="#22222210";Pattern.prototype.animate=function({callback:t,sync:e=!1,smear:n=.5}={}){window.frame&&cancelAnimationFrame(window.frame);const o=getDrawContext(),{clientWidth:s,clientHeight:i}=o.canvas;let a=n===0?"99":Number((1-n)*100).toFixed(0);a=a.length===1?`0${a}`:a,clearColor=`#200010${a}`;const l=c=>{let p;c=Math.round(c),p=this.slow(1e3).queryArc(c,c),o.fillStyle=clearColor,o.fillRect(0,0,s,i),p.forEach(u=>{let{x:f,y:d,w:m,h:_,s:k,r:v,angle:q=0,fill:C="darkseagreen"}=u.value;if(m*=s,_*=i,v!==void 0&&q!==void 0){const A=q*2*Math.PI,[P,T]=[(s-m)/2,(i-_)/2];f=P+Math.cos(A)*v*P,d=T+Math.sin(A)*v*T}else f*=s-m,d*=i-_;const b={...u.value,x:f,y:d,w:m,h:_};o.fillStyle=C,k==="rect"?o.fillRect(f,d,m,_):k==="ellipse"&&(o.beginPath(),o.ellipse(f+m/2,d+_/2,m/2,_/2,0,0,2*Math.PI),o.fill()),t&&t(o,b,u)}),window.frame=requestAnimationFrame(l)};return window.frame=requestAnimationFrame(l),silence};const{x,y,w,h,angle,r,fill,smear}=createParams("x","y","w","h","angle","r","fill","smear"),rescale=register("rescale",function(t,e){return e.mul(x(t).w(t).y(t).h(t))}),moveXY=register("moveXY",function(t,e,n){return n.add(x(t).y(e))}),zoomIn=register("zoomIn",function(t,e){const n=pure(1).sub(t).div(2);return e.rescale(t).move(n,n)}),scale=(t,e,n)=>t*(n-e)+e,getValue=t=>{let{value:e}=t;typeof t.value!="object"&&(e={value:e});let{note:n,n:o,freq:s,s:i}=e;return s?freqToMidi(s):(n=n??o,typeof n=="string"?noteToMidi(n):typeof n=="number"?n:i?"_"+i:e)};Pattern.prototype.pianoroll=function({cycles:t=4,playhead:e=.5,overscan:n=1,flipTime:o=0,flipValues:s=0,hideNegative:i=!1,inactive:a="#7491D2",active:l="#FFCA28",background:c="transparent",smear:p=0,playheadColor:u="white",minMidi:f=10,maxMidi:d=90,autorange:m=0,timeframe:_,fold:k=0,vertical:v=0,labels:q=0}={}){const C=getDrawContext(),b=C.canvas.width,A=C.canvas.height;let P=-t*e,T=t*(1-e);_&&(console.warn("timeframe is deprecated! use from/to instead"),P=0,T=_);const R=v?A:b,F=v?b:A;let B=v?[R,0]:[0,R];const z=T-P,$=v?[0,F]:[F,0];let I=d-f+1,j=F/I,W=[];return o&&B.reverse(),s&&$.reverse(),this.draw((S,V,L)=>{S.fillStyle=c,S.globalAlpha=1,p||(S.clearRect(0,0,b,A),S.fillRect(0,0,b,A));const G=g=>(!i||g.whole.begin>=0)&&g.whole.begin<=L+T&&g.endClipped>=L+P;V.filter(G).forEach(g=>{const N=g.whole.begin<=L&&g.endClipped>L;S.fillStyle=g.context?.color||a,S.strokeStyle=g.context?.color||l,S.globalAlpha=g.context.velocity??g.value?.gain??1;const M=scale((g.whole.begin-(o?T:P))/z,...B);let O=scale(g.duration/z,0,R);const E=getValue(g),Q=scale(k?W.indexOf(E)/W.length:(Number(E)-f)/I,...$);let U=0;const K=scale(L/z,...B);let D;if(v?D=[Q+1-(s?j:0),R-K+M+U+1-(o?0:O),j-2,O-2]:D=[M-K+U+1-(o?O:0),Q+1-(s?0:j),O-2,j-2],N?S.strokeRect(...D):S.fillRect(...D),q){const J=g.value.note??g.value.s+(g.value.n?`:${g.value.n}`:"");S.font=`${j*.75}px monospace`,S.strokeStyle="black",S.fillStyle=N?"white":"black",S.textBaseline="top",S.fillText(J,...D)}}),S.globalAlpha=1;const H=scale(-P/z,...B);S.strokeStyle=u,S.beginPath(),v?(S.moveTo(0,H),S.lineTo(F,H)):(S.moveTo(H,0),S.lineTo(H,F)),S.stroke()},{from:P-n,to:T+n,onQuery:S=>{const{min:V,max:L,values:G}=S.reduce(({min:H,max:g,values:N},M)=>{const O=getValue(M);return{min:O<H?O:H,max:O>g?O:g,values:N.includes(O)?N:[...N,O]}},{min:1/0,max:-1/0,values:[]});m&&(f=V,d=L,I=d-f+1),W=G.sort((H,g)=>String(H).localeCompare(String(g))),j=k?F/W.length:F/I}}),this};function pianoroll({time:t,haps:e,cycles:n=4,playhead:o=.5,flipTime:s=0,flipValues:i=0,hideNegative:a=!1,inactive:l="#7491D2",active:c="#FFCA28",background:p="transparent",smear:u=0,playheadColor:f="white",minMidi:d=10,maxMidi:m=90,autorange:_=0,timeframe:k,fold:v=0,vertical:q=0,labels:C=!1,ctx:b}={}){const A=b.canvas.width,P=b.canvas.height;let T=-n*o,R=n*(1-o);k&&(console.warn("timeframe is deprecated! use from/to instead"),T=0,R=k);const F=q?P:A,B=q?A:P;let z=q?[F,0]:[0,F];const $=R-T,I=q?[0,B]:[B,0];let j=m-d+1,W=B/j,S=[];s&&z.reverse(),i&&I.reverse();const{min:V,max:L,values:G}=e.reduce(({min:g,max:N,values:M},O)=>{const E=getValue(O);return{min:E<g?E:g,max:E>N?E:N,values:M.includes(E)?M:[...M,E]}},{min:1/0,max:-1/0,values:[]});_&&(d=V,m=L,j=m-d+1),S=G.sort((g,N)=>String(g).localeCompare(String(N))),W=v?B/S.length:B/j,b.fillStyle=p,b.globalAlpha=1,u||(b.clearRect(0,0,A,P),b.fillRect(0,0,A,P)),e.forEach(g=>{const N=g.whole.begin<=t&&g.whole.end>t,M=g.value?.color||g.context?.color;b.fillStyle=M||l,b.strokeStyle=M||c,b.globalAlpha=g.context.velocity??g.value?.gain??1;const O=scale((g.whole.begin-(s?R:T))/$,...z);let E=scale(g.duration/$,0,F);const Q=getValue(g),U=scale(v?S.indexOf(Q)/S.length:(Number(Q)-d)/j,...I);let K=0;const D=scale(t/$,...z);let J;if(q?J=[U+1-(i?W:0),F-D+O+K+1-(s?0:E),W-2,E-2]:J=[O-D+K+1-(s?E:0),U+1-(i?0:W),E-2,W-2],N?b.strokeRect(...J):b.fillRect(...J),C){const X=g.value.note??g.value.s+(g.value.n?`:${g.value.n}`:"");b.font=`${W*.75}px monospace`,b.strokeStyle="black",b.fillStyle=N?"white":"black",b.textBaseline="top",b.fillText(X,...J)}}),b.globalAlpha=1;const H=scale(-T/$,...z);return b.strokeStyle=f,b.beginPath(),q?(b.moveTo(0,H),b.lineTo(B,H)):(b.moveTo(H,0),b.lineTo(H,B)),b.stroke(),this}function getDrawOptions(t,e={}){let[n,o]=t;n=Math.abs(n);const s=o+n,i=n/s;return{fold:1,...e,cycles:s,playhead:i}}Pattern.prototype.punchcard=function(t){return this.onPaint((e,n,o,s)=>pianoroll({ctx:e,time:n,haps:o,...getDrawOptions(s,t)}))};function drawPianoroll(t){const{drawTime:e,...n}=t;pianoroll({...getDrawOptions(e),...n})}function fromPolar(t,e,n,o){const s=(t-90)*Math.PI/180;return[n+Math.cos(s)*e,o+Math.sin(s)*e]}const xyOnSpiral=(t,e,n,o,s=0)=>fromPolar((t+s)*360,e*t,n,o);function spiralSegment(t){let{ctx:e,from:n=0,to:o=3,margin:s=50,cx:i=100,cy:a=100,rotate:l=0,thickness:c=s/2,color:p="#0000ff30",cap:u="round",stretch:f=1,fromOpacity:d=1,toOpacity:m=1}=t;n*=f,o*=f,l*=f,e.lineWidth=c,e.lineCap=u,e.strokeStyle=p,e.globalAlpha=d,e.beginPath();let[_,k]=xyOnSpiral(n,s,i,a,l);e.moveTo(_,k);const v=1/60;let q=n;for(;q<=o;){const[C,b]=xyOnSpiral(q,s,i,a,l);e.globalAlpha=(q-n)/(o-n)*m,e.lineTo(C,b),q+=v}e.stroke()}Pattern.prototype.spiral=function(t={}){const{stretch:e=1,size:n=80,thickness:o=n/2,cap:s="butt",inset:i=3,playheadColor:a="#ffffff90",playheadLength:l=.02,playheadThickness:c=o,padding:p=0,steady:u=1,inactiveColor:f="#ffffff20",colorizeInactive:d=0,fade:m=!0}=t;function _({ctx:k,time:v,haps:q,drawTime:C}){k.clearRect(0,0,k.canvas.clientWidth,k.canvas.clientHeight);const[b,A]=[k.canvas.width/2,k.canvas.height/2],P={margin:n/e,cx:b,cy:A,stretch:e,cap:s,thickness:o},T={...P,thickness:c,from:i-l,to:i,color:a},[R]=C,F=u*v;q.forEach(B=>{const z=B.whole.begin<=v&&B.endClipped>v,$=B.whole.begin-v+i,I=B.endClipped-v+i-p,{color:j}=B.context,W=m?1-Math.abs((B.whole.begin-v)/R):1;spiralSegment({ctx:k,...P,from:$,to:I,rotate:F,color:d||z?j:f,fromOpacity:W,toOpacity:W})}),spiralSegment({ctx:k,...T,rotate:F})}return this.onPaint((k,v,q,C)=>_({ctx:k,time:v,haps:q,drawTime:C}))};function frame(t){window.strudelAnimation&&cancelAnimationFrame(window.strudelAnimation);const e=n=>{t(n,getTime()),window.strudelAnimation=requestAnimationFrame(e)};requestAnimationFrame(e)}const backgroundImage=function(t,e={}){const n=document.getElementById("code"),o="background-image:url("+t+");background-size:contain;";n.style=o;const{className:s}=n,i=(c,p)=>{({style:()=>n.style=o+";"+p,className:()=>n.className=p+" "+s})[c]()},a=Object.entries(e).filter(([c,p])=>typeof p=="function");Object.entries(e).filter(([c,p])=>typeof p=="string").forEach(([c,p])=>i(c,p)),a.length!==0&&frame((c,p)=>a.forEach(([u,f])=>{i(u,f(p))}))},cleanupUi=()=>{const t=document.getElementById("code");t&&(t.style="",t.className="grow flex text-gray-100 relative overflow-auto cursor-text pb-0")},gist=(route,cache=!0)=>fetch(`https://gist.githubusercontent.com/${route}?cachebust=${cache?"":Date.now()}`).then(t=>t.text()).then(code=>eval(code));logger("🌀 @strudel.cycles/core loaded 🌀");globalThis._strudelLoaded&&console.warn(`@strudel.cycles/core was loaded more than once...
This might happen when you have multiple versions of strudel installed. 
Please check with "npm ls @strudel.cycles/core".`);globalThis._strudelLoaded=!0;exports.Cyclist=Cyclist;exports.Drawer=Drawer;exports.Fraction=fraction;exports.Framer=Framer;exports.Hap=Hap;exports.Pattern=Pattern;exports.State=State;exports.TimeSpan=TimeSpan;exports.__chooseWith=__chooseWith;exports._brandBy=_brandBy;exports._irand=_irand;exports._mod=_mod;exports.add=add;exports.almostAlways=almostAlways;exports.almostNever=almostNever;exports.always=always;exports.and=and;exports.angle=angle;exports.apply=apply;exports.arrange=arrange;exports.backgroundImage=backgroundImage;exports.band=band;exports.bjork=bjork;exports.blshift=blshift;exports.bor=bor;exports.brak=brak;exports.brand=brand;exports.brandBy=brandBy;exports.brshift=brshift;exports.bxor=bxor;exports.bypass=bypass;exports.cat=cat;exports.ceil=ceil;exports.choose=choose;exports.chooseCycles=chooseCycles;exports.chooseInWith=chooseInWith;exports.chooseWith=chooseWith;exports.chop=chop;exports.chunk=chunk;exports.chunkBack=chunkBack;exports.chunkback=chunkback;exports.clamp=clamp;exports.cleanupDraw=cleanupDraw;exports.cleanupUi=cleanupUi;exports.color=color;exports.colour=colour;exports.compose=compose;exports.compress=compress;exports.compressSpan=compressSpan;exports.compressspan=compressspan;exports.constant=constant;exports.controls=controls;exports.cosine=cosine;exports.cosine2=cosine2;exports.cpm=cpm;exports.curry=curry;exports.degrade=degrade;exports.degradeBy=degradeBy;exports.degradeByWith=degradeByWith;exports.density=density;exports.div=div;exports.drawLine=drawLine;exports.drawPianoroll=drawPianoroll;exports.duration=duration;exports.early=early;exports.echo=echo;exports.echoWith=echoWith;exports.echowith=echowith;exports.eq=eq;exports.eqt=eqt;exports.euclid=euclid;exports.euclidLegato=euclidLegato;exports.euclidLegatoRot=euclidLegatoRot;exports.euclidRot=euclidRot;exports.euclidrot=euclidrot;exports.evalScope=evalScope;exports.evaluate=evaluate;exports.every=every;exports.fast=fast;exports.fastGap=fastGap;exports.fastcat=fastcat;exports.fastgap=fastgap;exports.fill=fill;exports.firstOf=firstOf;exports.flatten=flatten;exports.floor=floor;exports.focus=focus;exports.focusSpan=focusSpan;exports.focusspan=focusspan;exports.fractionalArgs=fractionalArgs;exports.freqToMidi=freqToMidi;exports.fromBipolar=fromBipolar;exports.func=func;exports.getDrawContext=getDrawContext;exports.getDrawOptions=getDrawOptions;exports.getFreq=getFreq;exports.getFrequency=getFrequency;exports.getPlayableNoteValue=getPlayableNoteValue;exports.getTime=getTime;exports.getTrigger=getTrigger;exports.gist=gist;exports.gt=gt;exports.gte=gte;exports.h=h;exports.hurry=hurry;exports.hush=hush;exports.id=id;exports.inside=inside;exports.inv=inv;exports.invert=invert;exports.irand=irand;exports.isNote=isNote;exports.isNoteWithOctave=isNoteWithOctave;exports.isPattern=isPattern;exports.isaw=isaw;exports.isaw2=isaw2;exports.iter=iter;exports.iterBack=iterBack;exports.iterback=iterback;exports.jux=jux;exports.juxBy=juxBy;exports.juxby=juxby;exports.keep=keep;exports.keepif=keepif;exports.lastOf=lastOf;exports.late=late;exports.legato=legato;exports.linger=linger;exports.listRange=listRange;exports.logKey=logKey;exports.logger=logger;exports.loopAt=loopAt;exports.loopAtCps=loopAtCps;exports.loopat=loopat;exports.loopatcps=loopatcps;exports.lt=lt;exports.lte=lte;exports.mapArgs=mapArgs;exports.mask=mask;exports.midi2note=midi2note;exports.midiToFreq=midiToFreq;exports.mod=mod;exports.moveXY=moveXY;exports.mul=mul;exports.ne=ne;exports.net=net;exports.never=never;exports.noteToMidi=noteToMidi;exports.numeralArgs=numeralArgs;exports.off=off;exports.often=often;exports.or=or;exports.outside=outside;exports.palindrome=palindrome;exports.parseFractional=parseFractional;exports.parseNumeral=parseNumeral;exports.perlin=perlin;exports.perlinWith=perlinWith;exports.pianoroll=pianoroll;exports.pipe=pipe;exports.ply=ply;exports.pm=pm;exports.polymeter=polymeter;exports.polymeterSteps=polymeterSteps;exports.polyrhythm=polyrhythm;exports.pow=pow;exports.pr=pr;exports.press=press;exports.pressBy=pressBy;exports.pure=pure;exports.r=r;exports.rand=rand;exports.rand2=rand2;exports.randcat=randcat;exports.range=range;exports.range2=range2;exports.rangex=rangex;exports.rarely=rarely;exports.ratio=ratio;exports.register=register;exports.reify=reify;exports.removeUndefineds=removeUndefineds;exports.repl=repl;exports.rescale=rescale;exports.rev=rev;exports.ribbon=ribbon;exports.rotate=rotate;exports.round=round;exports.run=run;exports.saw=saw;exports.saw2=saw2;exports.segment=segment;exports.seq=seq;exports.sequence=sequence;exports.set=set;exports.setStringParser=setStringParser;exports.setTime=setTime;exports.signal=signal;exports.silence=silence;exports.sine=sine;exports.sine2=sine2;exports.slice=slice;exports.slow=slow;exports.slowcat=slowcat;exports.slowcatPrime=slowcatPrime;exports.smear=smear;exports.sol2note=sol2note;exports.someCycles=someCycles;exports.someCyclesBy=someCyclesBy;exports.sometimes=sometimes;exports.sometimesBy=sometimesBy;exports.sparsity=sparsity;exports.speak=speak;exports.splice=splice;exports.splitAt=splitAt;exports.square=square;exports.square2=square2;exports.stack=stack;exports.steady=steady;exports.striate=striate;exports.struct=struct;exports.stut=stut;exports.stutWith=stutWith;exports.stutwith=stutwith;exports.sub=sub;exports.superimpose=superimpose;exports.time=time$1;exports.timeCat=timeCat;exports.toBipolar=toBipolar;exports.tokenizeNote=tokenizeNote;exports.tri=tri;exports.tri2=tri2;exports.undegrade=undegrade;exports.undegradeBy=undegradeBy;exports.valueToMidi=valueToMidi;exports.velocity=velocity;exports.w=w;exports.wchoose=wchoose;exports.wchooseCycles=wchooseCycles;exports.when=when;exports.x=x;exports.y=y;exports.zipWith=zipWith;exports.zoom=zoom;exports.zoomArc=zoomArc;exports.zoomIn=zoomIn;exports.zoomarc=zoomarc;
